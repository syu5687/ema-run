<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ihg Best Match | ãƒ•ã‚©ãƒ¼ãƒ â†’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåŒ–ï¼ˆv3.0 å®‰å®šç‰ˆï¼‰</title>
  <link rel="icon" href="data:,">
  <style>
	:root{--teal:#0e7490;--hdr:#083344;--blue:#2563eb;}
	body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",Helvetica,Arial,sans-serif;}

	/* ãƒ©ãƒ³ãƒãƒ£ãƒ¼ */
	.chat-launcher{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);display:flex;align-items:center;gap:10px;background:var(--teal);color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 10px 24px rgba(0,0,0,.25);z-index:2147483000;cursor:pointer;min-width:320px}
	.chat-launcher .chev{margin-left:6px;transition:transform .2s ease}
	.chat-launcher[aria-expanded="true"] .chev{transform:rotate(180deg)}
	@media(max-width:640px){.chat-launcher{left:0;right:0;bottom:0;transform:none;border-radius:0;justify-content:center;min-width:unset;width:100%}}

	/* ãƒãƒ£ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ */
	.chat{position:fixed;right:20px;bottom:96px;width:min(420px,calc(100vw - 40px));height:70vh;max-height:620px;border-radius:16px;background:#fff;box-shadow:0 20px 40px rgba(0,0,0,.25);display:flex;flex-direction:column;overflow:hidden;z-index:2147483001;opacity:0;visibility:hidden;pointer-events:none;transform:translateY(18px) scale(.98);transition:transform .28s,opacity .18s,visibility 0s linear .18s}
	.chat.open{opacity:1;visibility:visible;pointer-events:auto;transform:none}
	@media(max-width:640px){.chat{right:0;left:0;bottom:0;top:0;width:100vw;height:100vh;max-height:none;border-radius:0;transform:translateY(100%)}.chat.open{transform:translateY(0)}}

	.chat-header{padding:14px 16px;background:var(--hdr);color:#fff;display:flex;justify-content:space-between;align-items:center}
	.chat-body{padding:12px;gap:8px;display:flex;flex-direction:column;overflow-y:auto;background:#f8fafc}
	.sys,.user{max-width:86%;padding:10px 12px;border-radius:14px;font-size:14px;white-space:pre-wrap}
	.sys{background:#e2f0f6;align-self:flex-start}
	.user{background:#fff;align-self:flex-end;border:1px solid #e5e7eb}
	.chat-footer{padding:10px;display:grid;grid-template-columns:1fr auto;gap:8px;background:#fff}
	.chat-footer input{padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;font-size:14px}
	.chat-footer button{padding:10px 14px;border:0;border-radius:10px;background:var(--teal);color:#fff;cursor:pointer}

	/* é¸æŠè‚¢ */
	.choices{display:flex;flex-wrap:wrap;gap:6px 8px}
	.pill{padding:6px 12px;font-size:14px;border:1px solid #cbd5e1;border-radius:20px;background:#fff;cursor:pointer}
	.pill.selected{background:var(--teal);color:#fff;border-color:var(--teal)}
	.pill.disabled{opacity:.5;pointer-events:none}
	.confirm{border:1px solid var(--blue);background:#fff;color:var(--blue)}
	.confirm.active{background:var(--blue);color:#fff;border-color:var(--blue);animation:pulse 1s ease-in-out infinite}
	@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(37,99,235,.5)}50%{box-shadow:0 0 0 8px rgba(37,99,235,0)}}

	/* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼ */
	.loading{position:absolute;inset:0;background:rgba(255,255,255,.85);display:none;align-items:center;justify-content:center;z-index:10}
	.loading.active{display:flex}
	.spinner{width:48px;height:48px;border:4px solid var(--teal);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
	@keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="chat-launcher" id="launcher" role="button" tabindex="0" aria-controls="chatBox" aria-expanded="false"><span>ğŸ’¬ ã”ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ</span><span class="chev">â–´</span></div>
  <section class="chat" id="chatBox" role="dialog" aria-hidden="true">
	<div class="chat-header"><span>ã”ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ</span><button id="closeBtn">Ã—</button></div>
	<div class="chat-body" id="chat"></div>
	<div class="chat-footer"><input id="textInput" placeholder="ã“ã“ã«å…¥åŠ›â€¦" /><button id="sendBtn">é€ä¿¡</button></div>
	<div class="loading" id="loading"><div class="spinner"></div></div>
  </section>
<script>
(function(){
  // è³ªå•ãƒ•ãƒ­ãƒ¼å®šç¾©
  const FLOW=[
	{ key:'visited_before', label:'å½“é¤¨ã«ãŠè¶Šã—ã„ãŸã ã„ãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', type:'singleChoice', options:['ãªã—','ã‚ã‚‹ï¼ˆçµå©šå¼ï¼‰','ã‚ã‚‹ï¼ˆå®´ä¼šï¼‰'] },
	{ key:'tour_status', label:'å¼å ´è¦‹å­¦çŠ¶æ³ã¯ï¼Ÿ', type:'singleChoice', options:['åˆã‚ã¦','2å¼å ´ç›®','3å¼å ´ç›®','4å¼å ´ä»¥ä¸Š'] },
	{ key:'ceremony_style', label:'æŒ™å¼ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè¤‡æ•°å¯ï¼‰', type:'multiChoice', options:['ãƒãƒ£ãƒšãƒ«æŒ™å¼','äººå‰å¼ï¼ˆãƒãƒ£ãƒšãƒ«å†…ãƒ»ä¼šå ´å†…ï¼‰','ç¥å‰å¼','ã”æŠ«éœ²å®´ã®ã¿','ãã®ä»–'] },
	{ key:'guest_counts_groom', label:'ã”äºˆå®šäººæ•°ï¼ˆæ–°éƒå´ï¼‰', type:'text' },
	{ key:'guest_counts_bride', label:'ã”äºˆå®šäººæ•°ï¼ˆæ–°å©¦å´ï¼‰', type:'text' },
	{ key:'season_preference', label:'ã”å¸Œæœ›ã®æ™‚æœŸã‚’é¸æŠã—ã¦ãã ã•ã„', type:'singleChoice', options:['æ˜¥','å¤','ç§‹','å†¬','æœªå®š'] },
	{ key:'time_band', label:'æ™‚é–“å¸¯ã®ã”å¸Œæœ›', type:'singleChoice', options:['æ˜¼é£Ÿã«ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚’åˆã‚ã›ãŸã„','å¤•é£Ÿã«ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚’åˆã‚ã›ãŸã„'] },
	{ key:'costume', label:'è¡£è£³ï¼ˆè¤‡æ•°å¯ï¼‰', type:'multiChoice', options:['ã‚¦ã‚§ãƒ‡ã‚£ãƒ³ã‚°ãƒ‰ãƒ¬ã‚¹','ã‚«ã‚¯ãƒ†ãƒ«ãƒ‰ãƒ¬ã‚¹','ç™½ç„¡å¢','è‰²æ‰“æ›','ã‚¿ã‚­ã‚·ãƒ¼ãƒ‰','ç´‹ä»˜è¢´'] },
	{ key:'groom_name', label:'æ–°éƒæ§˜ã®ãŠåå‰ï¼ˆä¾‹ï¼šä½è³€ å¤ªéƒï¼‰', type:'text', required:true },
	{ key:'bride_name', label:'æ–°å©¦æ§˜ã®ãŠåå‰ï¼ˆä¾‹ï¼šä½è³€ èŠ±å­ï¼‰', type:'text', required:true },
	{ key:'phone', label:'é›»è©±ç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³å¯ï¼‰', type:'tel', required:true },
	{ key:'email', label:'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type:'email', required:true },
	{ key:'address', label:'ã”ä½æ‰€ï¼ˆå¸‚åŒºç”ºæ‘ä»¥é™ï¼‰', type:'text', required:true },
	{ key:'has_kids', label:'ãŠå­æ§˜ã¯ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã‹ï¼Ÿ', type:'singleChoice', options:['ã‚ã‚Š','ãªã—'] },
	{ key:'visit_1st', label:'æ¥é¤¨å¸Œæœ›æ—¥ï¼ˆç¬¬1å¸Œæœ›ï¼‰ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„', type:'date', required:true },
	{ key:'visit_2nd', label:'æ¥é¤¨å¸Œæœ›æ—¥ï¼ˆç¬¬2å¸Œæœ›ï¼‰ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„', type:'date', required:true },
	{ key:'consent', label:'å€‹äººæƒ…å ±ä¿è­·æ–¹é‡ã«åŒæ„ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿã€ŒåŒæ„ã—ã¾ã™ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', type:'consent', required:true }
  ];

  const state={step:0,answers:{},started:false};
  const chat=document.getElementById('chat');
  const textInput=document.getElementById('textInput');
  const sendBtn=document.getElementById('sendBtn');
  const widget=document.getElementById('chatBox');
  const launcher=document.getElementById('launcher');
  const closeBtn=document.getElementById('closeBtn');
  const loading=document.getElementById('loading');

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  function bubble(txt,who='sys'){const d=document.createElement('div');d.className=who;d.textContent=txt;chat.appendChild(d);chat.scrollTop=chat.scrollHeight}
  const todayISO=()=>new Date().toISOString().slice(0,10);

  // è³ªå•ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  function renderChoices(q){
	const wrap=document.createElement('div');wrap.className='sys choices';wrap.dataset.step=state.step;
	if(q.type==='singleChoice'){
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='pill';b.textContent=opt;b.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(opt);});wrap.appendChild(b)});
	} else { // multi
	  const selected=new Set();
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='pill';b.textContent=opt;b.addEventListener('click',()=>{b.classList.toggle('selected');b.classList.contains('selected')?selected.add(opt):selected.delete(opt);updateConfirm();});wrap.appendChild(b)});
	  const ok=document.createElement('button');ok.type='button';ok.className='pill confirm';ok.textContent='é¸æŠã‚’ç¢ºå®š';
	  function updateConfirm(){const n=selected.size;if(n>0){ok.classList.add('active');ok.textContent=`é¸æŠã‚’ç¢ºå®šï¼ˆ${n}ï¼‰`;}else{ok.classList.remove('active');ok.textContent='é¸æŠã‚’ç¢ºå®š';}}
	  ok.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(Array.from(selected));});wrap.appendChild(ok);
	}
	chat.appendChild(wrap);chat.scrollTop=chat.scrollHeight;
  }
  function disableChoices(wrap){wrap.querySelectorAll('button').forEach(b=>b.classList.add('disabled'));}

  // è³ªå•é€²è¡Œ
  function ask(){
	if(state.step>=FLOW.length){return finish();}
	const q=FLOW[state.step];
	bubble(`Q${state.step+1}ï¼š${q.label}`);
	if(q.type==='singleChoice'||q.type==='multiChoice') renderChoices(q);
	// å…¥åŠ›æ¬„åˆ¶å¾¡
	if(q.type==='date'){textInput.type='date';textInput.min=todayISO();textInput.value=todayISO();}
	else if(q.type==='email'){textInput.type='email';textInput.value='';}
	else if(q.type==='tel'){textInput.type='tel';textInput.value='';}
	else{textInput.type='text';textInput.value='';}
	textInput.focus();
  }

  // å›ç­”å‡¦ç†
  function handleAnswer(val){
	const q=FLOW[state.step];
	const raw=(val!==undefined)?val:(textInput.value||'').trim();
	if(q.required){
	  if(q.type==='consent'){if(raw!=='åŒæ„ã—ã¾ã™'){bubble('ã€ŒåŒæ„ã—ã¾ã™ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„');return;}}
	  else if(Array.isArray(raw)?raw.length===0:!raw){bubble('å¿…é ˆå…¥åŠ›ã§ã™');return;}
	}
	bubble(Array.isArray(raw)?raw.join('ã€'):raw,'user');
	state.answers[q.key]=raw;state.step++;
	loading.classList.add('active');
	setTimeout(()=>{loading.classList.remove('active');ask();},500);
  }

  // å®Œäº†
  function finish(){
	loading.classList.add('active');
	setTimeout(()=>{loading.classList.remove('active');bubble('é€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸï¼');},800);
  }

  // é–‹é–‰åˆ¶å¾¡ï¼ˆå®‰å®šç‰ˆï¼‰
  let toggleBusy=false;
  function openWidget(){widget.classList.add('open');launcher.setAttribute('aria-expanded','true');widget.setAttribute('aria-hidden','false');if(!state.started){state.started=true;bubble('ã”ç›¸è«‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ã„ãã¤ã‹ã®è³ªå•ã«ãŠç­”ãˆãã ã•ã„ã€‚');ask();}}
  function closeWidget(){widget.classList.remove('open');launcher.setAttribute('aria-expanded','false');widget.setAttribute('aria-hidden','true');}
  function toggleWidget(){if(toggleBusy) return;toggleBusy=true;setTimeout(()=>toggleBusy=false,200);widget.classList.contains('open')?closeWidget():openWidget();}

  launcher.onclick=toggleWidget;
  closeBtn.onclick=closeWidget;
  sendBtn.onclick=()=>handleAnswer();
  document.addEventListener('keydown',e=>{if(e.key==='Escape') closeWidget();});

  // åˆæœŸã¯é–‰ã˜ã‚‹
  closeWidget();
})();
</script>
</body>
</html>
