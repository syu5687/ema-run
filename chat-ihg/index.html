<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ihg Best Match | ãƒ•ã‚©ãƒ¼ãƒ â†’ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆåŒ–ï¼ˆv3.6.2 THANKSå¤–éƒ¨URLï¼‹å®‰å…¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</title>
  <link rel="icon" href="data:,">
  <style>
	:root{--ihgcb-teal:#0e7490;--ihgcb-hdr:#083344;--ihgcb-blue:#2563eb;}
	body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",Helvetica,Arial,sans-serif;}

	/* ==== ãƒ©ãƒ³ãƒãƒ£ãƒ¼ï¼ˆIDã‚¹ã‚³ãƒ¼ãƒ—ï¼‰ ==== */
	#ihgcb-launcher{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);display:flex;align-items:center;gap:10px;background:var(--ihgcb-teal);color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 10px 24px rgba(0,0,0,.25);z-index:2147483000;cursor:pointer;min-width:320px;width:fit-content;pointer-events:auto}
	#ihgcb-launcher .ihgcb-chev{margin-left:6px;transition:transform .2s ease}
	#ihgcb-launcher[aria-expanded="true"] .ihgcb-chev{transform:rotate(180deg)}
	@media(max-width:640px){#ihgcb-launcher{left:0;right:0;bottom:0;transform:none;border-radius:0;justify-content:center;min-width:unset;width:100%}}

	/* ==== ãƒãƒ£ãƒƒãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆIDã‚¹ã‚³ãƒ¼ãƒ—ã§ä»–ã‚µã‚¤ãƒˆCSSã¨è¡çªã—ãªã„ï¼‰ ==== */
	#ihgcb-box{position:fixed;right:20px;bottom:96px;width:min(420px,calc(100vw - 40px));height:70vh;max-height:620px;border-radius:16px;background:#fff;box-shadow:0 20px 40px rgba(0,0,0,.25);display:flex;flex-direction:column;overflow:hidden;z-index:2147483001;opacity:0;visibility:hidden;pointer-events:none;transform:translateY(18px) scale(.98);transition:transform .28s,opacity .18s,visibility 0s linear .18s}
	#ihgcb-box.open{opacity:1;visibility:visible;pointer-events:auto;transform:none}
	@media(max-width:640px){#ihgcb-box{right:0;left:0;bottom:0;top:0;width:100vw;height:100vh;max-height:none;border-radius:0;transform:translateY(100%)}#ihgcb-box.open{transform:translateY(0)}}

	#ihgcb-box .ihgcb-header{padding:14px 16px;background:var(--ihgcb-hdr);color:#fff;display:flex;justify-content:space-between;align-items:center}
	#ihgcb-box .ihgcb-body{padding:12px;gap:8px;display:flex;flex-direction:column;overflow-y:auto;background:#f8fafc}
	#ihgcb-box .ihgcb-sys,#ihgcb-box .ihgcb-user{max-width:86%;padding:10px 12px;border-radius:14px;font-size:14px;white-space:pre-wrap}
	#ihgcb-box .ihgcb-sys{background:#e2f0f6;align-self:flex-start}
	#ihgcb-box .ihgcb-user{background:#fff;align-self:flex-end;border:1px solid #e5e7eb}

	#ihgcb-box .ihgcb-footer{padding:10px;display:grid;grid-template-columns:1fr auto;gap:8px;background:#fff}
	#ihgcb-input{padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;font-size:14px}
	#ihgcb-send{padding:10px 14px;border:0;border-radius:10px;background:var(--ihgcb-teal);color:#fff;cursor:pointer}

	/* é¸æŠè‚¢ */
	#ihgcb-box .ihgcb-choices{display:flex;flex-wrap:wrap;gap:6px 8px}
	#ihgcb-box .ihgcb-pill{padding:6px 12px;font-size:14px;border:1px solid #cbd5e1;border-radius:20px;background:#fff;cursor:pointer}
	#ihgcb-box .ihgcb-pill.selected{background:var(--ihgcb-teal);color:#fff;border-color:var(--ihgcb-teal)}
	#ihgcb-box .ihgcb-pill.disabled{opacity:.5;pointer-events:none}
	#ihgcb-box .ihgcb-confirm{border:1px solid var(--ihgcb-blue);background:#fff;color:var(--ihgcb-blue)}
	#ihgcb-box .ihgcb-confirm.active{background:var(--ihgcb-blue);color:#fff;border-color:var(--ihgcb-blue);animation:ihgcb-pulse 1s ease-in-out infinite}
	@keyframes ihgcb-pulse{0%,100%{box-shadow:0 0 0 0 rgba(37,99,235,.5)}50%{box-shadow:0 0 0 8px rgba(37,99,235,0)}}

	/* ã‚¹ãƒ”ãƒŠãƒ¼ */
	#ihgcb-box .ihgcb-loading{position:absolute;inset:0;background:rgba(255,255,255,.85);display:none;align-items:center;justify-content:center;z-index:10}
	#ihgcb-box .ihgcb-loading.active{display:flex}
	#ihgcb-box .ihgcb-spinner{width:48px;height:48px;border:4px solid var(--ihgcb-teal);border-top-color:transparent;border-radius:50%;animation:ihgcb-spin 1s linear infinite}
	@keyframes ihgcb-spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- ãƒ©ãƒ³ãƒãƒ£ãƒ¼ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èµ·å‹•ã‚‚è£…å‚™ï¼‰ -->
  <div id="ihgcb-launcher" role="button" tabindex="0" aria-controls="ihgcb-box" aria-expanded="false" onclick="window.ihgcb_toggle && window.ihgcb_toggle()">
	<span>ğŸ’¬ ã”ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ</span><span class="ihgcb-chev">â–´</span>
  </div>

  <!-- ãƒãƒ£ãƒƒãƒˆæœ¬ä½“ï¼ˆå®Œå…¨ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ï¼‰ -->
  <section id="ihgcb-box" role="dialog" aria-hidden="true">
	<div class="ihgcb-header"><span>ã”ç›¸è«‡ãƒãƒ£ãƒƒãƒˆ</span><button id="ihgcb-close" aria-label="é–‰ã˜ã‚‹">Ã—</button></div>
	<div class="ihgcb-body" id="ihgcb-chat"></div>
	<div class="ihgcb-footer"><input id="ihgcb-input" placeholder="ã“ã“ã«å…¥åŠ›â€¦" /><button id="ihgcb-send">é€ä¿¡</button></div>
	<div class="ihgcb-loading" id="ihgcb-loading"><div class="ihgcb-spinner"></div></div>
  </section>

<script>
(function(){
  // ===== è¨­å®š =====
  function safeThanksUrl(){
	try{
	  const search = (typeof location !== 'undefined' && typeof location.search === 'string') ? location.search : '';
	  const sp = new URLSearchParams(search);
	  const p = sp.get('thanks');
	  // "thanks" ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã‚Œã‚’ä½¿ã†ï¼ˆå±é™ºã‚¹ã‚­ãƒ¼ãƒ ã¯æ‹’å¦ï¼‰
	  if(p && /^(https?:\/\/|\/|\.|[A-Za-z0-9_\-])/.test(p) && !/^javascript:/i.test(p)){
		return p;
	  }
	}catch(_){}
	// æ—¢å®šã¯å¤–éƒ¨ã®ã‚µãƒ³ã‚¯ã‚¹URL
	return 'https://islandhills.jp/contact-thanks-bot/';
  }
  const THANKS_URL = safeThanksUrl();

  // ===== ãƒ•ãƒ­ãƒ¼ =====
  const FLOW=[
	{ key:'visited_before', label:'å½“é¤¨ã«ãŠè¶Šã—ã„ãŸã ã„ãŸã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', type:'singleChoice', options:['ãªã—','ã‚ã‚‹ï¼ˆçµå©šå¼ï¼‰','ã‚ã‚‹ï¼ˆå®´ä¼šï¼‰'] },
	{ key:'tour_status', label:'å¼å ´è¦‹å­¦çŠ¶æ³ã¯ï¼Ÿ', type:'singleChoice', options:['åˆã‚ã¦','2å¼å ´ç›®','3å¼å ´ç›®','4å¼å ´ä»¥ä¸Š'] },
	{ key:'ceremony_style', label:'æŒ™å¼ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè¤‡æ•°å¯ï¼‰', type:'multiChoice', options:['ãƒãƒ£ãƒšãƒ«æŒ™å¼','äººå‰å¼ï¼ˆãƒãƒ£ãƒšãƒ«å†…ãƒ»ä¼šå ´å†…ï¼‰','ç¥å‰å¼','ã”æŠ«éœ²å®´ã®ã¿','ãã®ä»–'] },
	{ key:'guest_counts_groom', label:'ã”äºˆå®šäººæ•°ï¼ˆæ–°éƒå´ï¼‰', type:'text' },
	{ key:'guest_counts_bride', label:'ã”äºˆå®šäººæ•°ï¼ˆæ–°å©¦å´ï¼‰', type:'text' },
	{ key:'season_preference', label:'ã”å¸Œæœ›ã®æ™‚æœŸã‚’é¸æŠã—ã¦ãã ã•ã„', type:'singleChoice', options:['æ˜¥','å¤','ç§‹','å†¬','æœªå®š'] },
	{ key:'time_band', label:'æ™‚é–“å¸¯ã®ã”å¸Œæœ›', type:'singleChoice', options:['æ˜¼é£Ÿã«ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚’åˆã‚ã›ãŸã„','å¤•é£Ÿã«ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚’åˆã‚ã›ãŸã„'] },
	{ key:'costume', label:'è¡£è£³ï¼ˆè¤‡æ•°å¯ï¼‰', type:'multiChoice', options:['ã‚¦ã‚§ãƒ‡ã‚£ãƒ³ã‚°ãƒ‰ãƒ¬ã‚¹','ã‚«ã‚¯ãƒ†ãƒ«ãƒ‰ãƒ¬ã‚¹','ç™½ç„¡å¢','è‰²æ‰“æ›','ã‚¿ã‚­ã‚·ãƒ¼ãƒ‰','ç´‹ä»˜è¢´'] },
	{ key:'groom_name', label:'æ–°éƒæ§˜ã®ãŠåå‰ï¼ˆä¾‹ï¼šä½è³€ å¤ªéƒï¼‰', type:'text', required:true },
	{ key:'bride_name', label:'æ–°å©¦æ§˜ã®ãŠåå‰ï¼ˆä¾‹ï¼šä½è³€ èŠ±å­ï¼‰', type:'text', required:true },
	{ key:'phone', label:'é›»è©±ç•ªå·ï¼ˆãƒã‚¤ãƒ•ãƒ³å¯ï¼‰', type:'tel', required:true },
	{ key:'email', label:'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', type:'email', required:true },
	{ key:'address', label:'ã”ä½æ‰€ï¼ˆå¸‚åŒºç”ºæ‘ä»¥é™ï¼‰', type:'text', required:true },
	{ key:'has_kids', label:'ãŠå­æ§˜ã¯ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã‹ï¼Ÿ', type:'singleChoice', options:['ã‚ã‚Š','ãªã—'] },
	{ key:'visit_1st', label:'æ¥é¤¨å¸Œæœ›æ—¥ï¼ˆç¬¬1å¸Œæœ›ï¼‰ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„', type:'date', required:true },
	{ key:'visit_2nd', label:'æ¥é¤¨å¸Œæœ›æ—¥ï¼ˆç¬¬2å¸Œæœ›ï¼‰ã‚’ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰é¸æŠã—ã¦ãã ã•ã„', type:'date', required:true }
  ];

  // ===== å‚ç…§ï¼ˆå…¨éƒ¨ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹IDï¼‰ =====
  const launcher=document.getElementById('ihgcb-launcher');
  const box=document.getElementById('ihgcb-box');
  const chat=document.getElementById('ihgcb-chat');
  const input=document.getElementById('ihgcb-input');
  const send=document.getElementById('ihgcb-send');
  const closeBtn=document.getElementById('ihgcb-close');
  const loading=document.getElementById('ihgcb-loading');

  const state={step:0,answers:{},started:false,confirming:false};
  const todayISO=()=>new Date().toISOString().slice(0,10);
  function bubble(txt,who='ihgcb-sys'){const d=document.createElement('div');d.className=who;d.textContent=txt;chat.appendChild(d);chat.scrollTop=chat.scrollHeight}

  // ===== UI: é¸æŠè‚¢ =====
  function renderChoices(q){
	const wrap=document.createElement('div');wrap.className='ihgcb-sys ihgcb-choices';wrap.dataset.step=state.step;
	if(q.type==='singleChoice'){
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent=opt;b.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(opt);});wrap.appendChild(b)});
	}else{ // multi
	  const selected=new Set();
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent=opt;b.addEventListener('click',()=>{b.classList.toggle('selected');b.classList.contains('selected')?selected.add(opt):selected.delete(opt);updateConfirm();});wrap.appendChild(b)});
	  const ok=document.createElement('button');ok.type='button';ok.className='ihgcb-pill ihgcb-confirm';ok.textContent='é¸æŠã‚’ç¢ºå®š';
	  function updateConfirm(){const n=selected.size;if(n>0){ok.classList.add('active');ok.textContent=`é¸æŠã‚’ç¢ºå®šï¼ˆ${n}ï¼‰`;}else{ok.classList.remove('active');ok.textContent='é¸æŠã‚’ç¢ºå®š';}}
	  ok.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(Array.from(selected));});
	  wrap.appendChild(ok);
	}
	chat.appendChild(wrap);chat.scrollTop=chat.scrollHeight;
  }
  function disableChoices(wrap){wrap.querySelectorAll('button').forEach(b=>b.classList.add('disabled'));}

  // ===== é€²è¡Œ =====
  function ask(){
	if(state.step>=FLOW.length){return confirmBeforeSend();}
	const q=FLOW[state.step];
	bubble(`Q${state.step+1}ï¼š${q.label}`);

	if(q.type==='singleChoice'||q.type==='multiChoice'){
	  renderChoices(q);
	  send.disabled=true; // æœªé¸æŠã§é€²ã¾ãªã„
	  input.type='text'; input.value='';
	}else{
	  send.disabled=false;
	  if(q.type==='date'){input.type='date';input.min=todayISO();input.value=todayISO();}
	  else if(q.type==='email'){input.type='email';input.value='';}
	  else if(q.type==='tel'){input.type='tel';input.value='';}
	  else{input.type='text';input.value='';}
	  input.focus();
	}
  }

  function handleAnswer(val){
	const q=FLOW[state.step];
	if(val===undefined && (q.type==='singleChoice'||q.type==='multiChoice')){ bubble('é¸æŠè‚¢ã‚’ãŠé¸ã³ãã ã•ã„'); return; }
	const raw=(val!==undefined)?val:(input.value||'').trim();
	if(q.required){ if(Array.isArray(raw)?raw.length===0:!raw){ bubble('å¿…é ˆå…¥åŠ›ã§ã™'); return; } }
	bubble(Array.isArray(raw)?raw.join('ã€'):raw,'ihgcb-user');
	state.answers[q.key]=raw; state.step++;
	loading.classList.add('active');
	setTimeout(()=>{ loading.classList.remove('active'); ask(); },500);
  }

  function confirmBeforeSend(){
	if(state.confirming) return; state.confirming=true;
	bubble('ã“ã®å†…å®¹ã§é€ä¿¡ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ');
	const wrap=document.createElement('div');wrap.className='ihgcb-sys ihgcb-choices';
	const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent='ã¯ã„';
	b.addEventListener('click',()=>{disableChoices(wrap); finish();});
	wrap.appendChild(b); chat.appendChild(wrap); chat.scrollTop=chat.scrollHeight;
  }

  function finish(){
	loading.classList.add('active');
	setTimeout(()=>{
	  loading.classList.remove('active');
	  bubble('ã“ã®å†…å®¹ã§é€ä¿¡ã—ã¾ã™');
	  setTimeout(()=>{
		try{
		  // ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã§ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã‚‚è½ã¨ã•ãªã„
		  if(typeof location !== 'undefined' && typeof location.assign === 'function'){
			window.location.assign(THANKS_URL);
		  }else{
			throw new Error('navigation not allowed');
		  }
		}catch(err){
		  // ä»£æ›¿: ãƒãƒ£ãƒƒãƒˆå†…ã«ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
		  const msg=document.createElement('div');
		  msg.className='ihgcb-sys';
		  const a=document.createElement('a');
		  a.href=THANKS_URL; a.textContent='â†’ ã‚µãƒ³ã‚¯ã‚¹ãƒšãƒ¼ã‚¸ã¸ç§»å‹•'; a.target='_blank'; a.rel='noopener noreferrer';
		  msg.appendChild(a);
		  chat.appendChild(msg); chat.scrollTop=chat.scrollHeight;
		}
	  },900);
	},800);
  }

  // ===== é–‹é–‰ï¼ˆå…¬é–‹ & ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¤šæ•°ï¼‰ =====
  let toggleBusy=false;
  function openBox(){ box.classList.add('open'); launcher.setAttribute('aria-expanded','true'); box.setAttribute('aria-hidden','false'); if(!state.started){ state.started=true; bubble('ã”ç›¸è«‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ã„ãã¤ã‹ã®è³ªå•ã«ãŠç­”ãˆãã ã•ã„ã€‚'); ask(); } }
  function closeBox(){ box.classList.remove('open'); launcher.setAttribute('aria-expanded','false'); box.setAttribute('aria-hidden','true'); }
  function toggle(){ try{ if(toggleBusy) return; toggleBusy=true; setTimeout(()=>toggleBusy=false,200); box.classList.contains('open')? closeBox(): openBox(); } catch(e){ try{ openBox(); }catch(_){} } }

  // ç›´æ¥ãƒã‚¤ãƒ³ãƒ‰
  launcher.onclick = toggle;
  closeBtn.onclick = closeBox;
  send.onclick = ()=>handleAnswer();
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeBox(); });

  // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå§”è­²
  document.addEventListener('click',function(e){ const t=e.target && (e.target.id==='ihgcb-launcher'? e.target : (e.target.closest && e.target.closest('#ihgcb-launcher'))); if(t){ toggle(); } },{passive:true});
  document.addEventListener('keydown',function(e){ if((e.key==='Enter'||e.key===' ') && document.activeElement && document.activeElement.id==='ihgcb-launcher'){ e.preventDefault(); toggle(); } });

  // ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èµ·å‹•ç”¨ï¼‰
  window.ihgcb_toggle = toggle;

  // ãƒ©ãƒ³ãƒãƒ£ãƒ¼DOMãŒå·®ã—æ›¿ãˆã‚‰ã‚Œã¦ã‚‚å†ãƒã‚¤ãƒ³ãƒ‰
  if('MutationObserver' in window){
	new MutationObserver(()=>{ const ln=document.getElementById('ihgcb-launcher'); if(ln && !ln.onclick){ ln.onclick=toggle; } }).observe(document.body,{childList:true,subtree:true});
  }

  // åˆæœŸã¯é–‰ã˜ã‚‹
  closeBox();

  // ===== ç°¡æ˜“ã‚»ãƒ«ãƒ•ãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒ©ãƒ¼æ—©æœŸæ¤œçŸ¥ï¼‰ =====
  (function selfTest(){
	try{
	  const must = [launcher, box, chat, input, send, closeBtn, loading];
	  if(must.some(n=>!n)) throw new Error('å¿…é ˆDOMãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
	  if(typeof window.ihgcb_toggle !== 'function') throw new Error('toggleæœªå…¬é–‹');
	  // THANKS_URLã®è§£æ±ºãŒç©ºæ–‡å­—ã§ãªã„ã“ã¨
	  if(!THANKS_URL || typeof THANKS_URL!=='string') throw new Error('THANKS_URLãŒä¸æ­£');
	  console.log('[ihgcb] self-test: OK', {THANKS_URL});
	}catch(err){
	  console.error('[ihgcb] self-test failed:', err);
	}
  })();

  // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ã‚’æ¡ã‚Šã¤ã¶ã•ãšãƒ­ã‚°
  window.addEventListener('error', function(ev){
	try{ console.error('[ihgcb] window error:', ev.error || ev.message); }catch(_){}
  });
})();
</script>
</body>
</html>
