<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ihg Best Match | „Éï„Ç©„Éº„É†‚Üí„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„ÉàÂåñÔºàv3.6.2 THANKSÂ§ñÈÉ®URLÔºãÂÆâÂÖ®„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ôºâ</title>
  <link rel="icon" href="data:,">
  <style>
	:root{--ihgcb-teal:#0e7490;--ihgcb-hdr:#083344;--ihgcb-blue:#2563eb;}
	body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",Helvetica,Arial,sans-serif;}

	/* ==== „É©„É≥„ÉÅ„É£„ÉºÔºàID„Çπ„Ç≥„Éº„ÉóÔºâ ==== */
	#ihgcb-launcher{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);display:flex;align-items:center;gap:10px;background:var(--ihgcb-teal);color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 10px 24px rgba(0,0,0,.25);z-index:2147483000;cursor:pointer;min-width:320px;width:fit-content;pointer-events:auto}
	#ihgcb-launcher .ihgcb-chev{margin-left:6px;transition:transform .2s ease}
	#ihgcb-launcher[aria-expanded="true"] .ihgcb-chev{transform:rotate(180deg)}
	@media(max-width:640px){#ihgcb-launcher{left:0;right:0;bottom:0;transform:none;border-radius:0;justify-content:center;min-width:unset;width:100%}}

	/* ==== „ÉÅ„É£„ÉÉ„Éà„Ç¶„Ç£„É≥„Éâ„Ç¶ÔºàID„Çπ„Ç≥„Éº„Éó„Åß‰ªñ„Çµ„Ç§„ÉàCSS„Å®Ë°ùÁ™Å„Åó„Å™„ÅÑÔºâ ==== */
	#ihgcb-box{position:fixed;right:20px;bottom:96px;width:min(420px,calc(100vw - 40px));height:70vh;max-height:620px;border-radius:16px;background:#fff;box-shadow:0 20px 40px rgba(0,0,0,.25);display:flex;flex-direction:column;overflow:hidden;z-index:2147483001;opacity:0;visibility:hidden;pointer-events:none;transform:translateY(18px) scale(.98);transition:transform .28s,opacity .18s,visibility 0s linear .18s}
	#ihgcb-box.open{opacity:1;visibility:visible;pointer-events:auto;transform:none}
	@media(max-width:640px){#ihgcb-box{right:0;left:0;bottom:0;top:0;width:100vw;height:100vh;max-height:none;border-radius:0;transform:translateY(100%)}#ihgcb-box.open{transform:translateY(0)}}

	#ihgcb-box .ihgcb-header{padding:14px 16px;background:var(--ihgcb-hdr);color:#fff;display:flex;justify-content:space-between;align-items:center}
	#ihgcb-box .ihgcb-body{padding:12px;gap:8px;display:flex;flex-direction:column;overflow-y:auto;background:#f8fafc}
	#ihgcb-box .ihgcb-sys,#ihgcb-box .ihgcb-user{max-width:86%;padding:10px 12px;border-radius:14px;font-size:14px;white-space:pre-wrap}
	#ihgcb-box .ihgcb-sys{background:#e2f0f6;align-self:flex-start}
	#ihgcb-box .ihgcb-user{background:#fff;align-self:flex-end;border:1px solid #e5e7eb}

	#ihgcb-box .ihgcb-footer{padding:10px;display:grid;grid-template-columns:1fr auto;gap:8px;background:#fff}
	#ihgcb-input{padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px;font-size:14px}
	#ihgcb-send{padding:10px 14px;border:0;border-radius:10px;background:var(--ihgcb-teal);color:#fff;cursor:pointer}

	/* ÈÅ∏ÊäûËÇ¢ */
	#ihgcb-box .ihgcb-choices{display:flex;flex-wrap:wrap;gap:6px 8px}
	#ihgcb-box .ihgcb-pill{padding:6px 12px;font-size:14px;border:1px solid #cbd5e1;border-radius:20px;background:#fff;cursor:pointer}
	#ihgcb-box .ihgcb-pill.selected{background:var(--ihgcb-teal);color:#fff;border-color:var(--ihgcb-teal)}
	#ihgcb-box .ihgcb-pill.disabled{opacity:.5;pointer-events:none}
	#ihgcb-box .ihgcb-confirm{border:1px solid var(--ihgcb-blue);background:#fff;color:var(--ihgcb-blue)}
	#ihgcb-box .ihgcb-confirm.active{background:var(--ihgcb-blue);color:#fff;border-color:var(--ihgcb-blue);animation:ihgcb-pulse 1s ease-in-out infinite}
	@keyframes ihgcb-pulse{0%,100%{box-shadow:0 0 0 0 rgba(37,99,235,.5)}50%{box-shadow:0 0 0 8px rgba(37,99,235,0)}}

	/* „Çπ„Éî„Éä„Éº */
	#ihgcb-box .ihgcb-loading{position:absolute;inset:0;background:rgba(255,255,255,.85);display:none;align-items:center;justify-content:center;z-index:10}
	#ihgcb-box .ihgcb-loading.active{display:flex}
	#ihgcb-box .ihgcb-spinner{width:48px;height:48px;border:4px solid var(--ihgcb-teal);border-top-color:transparent;border-radius:50%;animation:ihgcb-spin 1s linear infinite}
	@keyframes ihgcb-spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- „É©„É≥„ÉÅ„É£„ÉºÔºà„Ç§„É≥„É©„Ç§„É≥Ëµ∑Âãï„ÇÇË£ÖÂÇôÔºâ -->
  <div id="ihgcb-launcher" role="button" tabindex="0" aria-controls="ihgcb-box" aria-expanded="false" onclick="window.ihgcb_toggle && window.ihgcb_toggle()">
	<span>üí¨ „ÅîÁõ∏Ë´á„ÉÅ„É£„ÉÉ„Éà</span><span class="ihgcb-chev">‚ñ¥</span>
  </div>

  <!-- „ÉÅ„É£„ÉÉ„ÉàÊú¨‰ΩìÔºàÂÆåÂÖ®„Éç„Éº„É†„Çπ„Éö„Éº„ÇπÔºâ -->
  <section id="ihgcb-box" role="dialog" aria-hidden="true">
	<div class="ihgcb-header"><span>„ÅîÁõ∏Ë´á„ÉÅ„É£„ÉÉ„Éà</span><button id="ihgcb-close" aria-label="Èñâ„Åò„Çã">√ó</button></div>
	<div class="ihgcb-body" id="ihgcb-chat"></div>
	<div class="ihgcb-footer"><input id="ihgcb-input" placeholder="„Åì„Åì„Å´ÂÖ•Âäõ‚Ä¶" /><button id="ihgcb-send">ÈÄÅ‰ø°</button></div>
	<div class="ihgcb-loading" id="ihgcb-loading"><div class="ihgcb-spinner"></div></div>
  </section>

<script>
(function(){
  // ===== Ë®≠ÂÆö =====
  function safeThanksUrl(){
	try{
	  const search = (typeof location !== 'undefined' && typeof location.search === 'string') ? location.search : '';
	  const sp = new URLSearchParams(search);
	  const p = sp.get('thanks');
	  // "thanks" „ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Çå„Å∞„Åù„Çå„Çí‰Ωø„ÅÜÔºàÂç±Èô∫„Çπ„Ç≠„Éº„É†„ÅØÊãíÂê¶Ôºâ
	  if(p && /^(https?:\/\/|\/|\.|[A-Za-z0-9_\-])/.test(p) && !/^javascript:/i.test(p)){
		return p;
	  }
	}catch(_){}
	// Êó¢ÂÆö„ÅØÂ§ñÈÉ®„ÅÆ„Çµ„É≥„ÇØ„ÇπURL
	return 'https://islandhills.jp/contact-thanks-bot/';
  }
  const THANKS_URL = safeThanksUrl();

  // ===== „Éï„É≠„Éº =====
  const FLOW=[
	{ key:'visited_before', label:'ÂΩìÈ§®„Å´„ÅäË∂ä„Åó„ÅÑ„Åü„Å†„ÅÑ„Åü„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü', type:'singleChoice', options:['„Å™„Åó','„ÅÇ„ÇãÔºàÁµêÂ©öÂºèÔºâ','„ÅÇ„ÇãÔºàÂÆ¥‰ºöÔºâ'] },
	{ key:'tour_status', label:'ÂºèÂ†¥Ë¶ãÂ≠¶Áä∂Ê≥Å„ÅØÔºü', type:'singleChoice', options:['Âàù„ÇÅ„Å¶','2ÂºèÂ†¥ÁõÆ','3ÂºèÂ†¥ÁõÆ','4ÂºèÂ†¥‰ª•‰∏ä'] },
	{ key:'ceremony_style', label:'ÊåôÂºè„Çπ„Çø„Ç§„É´ÔºàË§áÊï∞ÂèØÔºâ', type:'multiChoice', options:['„ÉÅ„É£„Éö„É´ÊåôÂºè','‰∫∫ÂâçÂºèÔºà„ÉÅ„É£„Éö„É´ÂÜÖ„Éª‰ºöÂ†¥ÂÜÖÔºâ','Á•ûÂâçÂºè','„ÅîÊä´Èú≤ÂÆ¥„ÅÆ„Åø','„Åù„ÅÆ‰ªñ'] },
	{ key:'guest_counts_groom', label:'„Åî‰∫àÂÆö‰∫∫Êï∞ÔºàÊñ∞ÈÉéÂÅ¥Ôºâ', type:'text' },
	{ key:'guest_counts_bride', label:'„Åî‰∫àÂÆö‰∫∫Êï∞ÔºàÊñ∞Â©¶ÂÅ¥Ôºâ', type:'text' },
	{ key:'season_preference', label:'„ÅîÂ∏åÊúõ„ÅÆÊôÇÊúü„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', type:'singleChoice', options:['Êò•','Â§è','Áßã','ÂÜ¨','Êú™ÂÆö'] },
	{ key:'time_band', label:'ÊôÇÈñìÂ∏Ø„ÅÆ„ÅîÂ∏åÊúõ', type:'singleChoice', options:['ÊòºÈ£ü„Å´„Éë„Éº„ÉÜ„Ç£„Éº„ÇíÂêà„Çè„Åõ„Åü„ÅÑ','Â§ïÈ£ü„Å´„Éë„Éº„ÉÜ„Ç£„Éº„ÇíÂêà„Çè„Åõ„Åü„ÅÑ'] },
	{ key:'costume', label:'Ë°£Ë£≥ÔºàË§áÊï∞ÂèØÔºâ', type:'multiChoice', options:['„Ç¶„Çß„Éá„Ç£„É≥„Ç∞„Éâ„É¨„Çπ','„Ç´„ÇØ„ÉÜ„É´„Éâ„É¨„Çπ','ÁôΩÁÑ°Âû¢','Ëâ≤ÊâìÊéõ','„Çø„Ç≠„Ç∑„Éº„Éâ','Á¥ã‰ªòË¢¥'] },
	{ key:'groom_name', label:'Êñ∞ÈÉéÊßò„ÅÆ„ÅäÂêçÂâçÔºà‰æãÔºö‰ΩêË≥Ä Â§™ÈÉéÔºâ', type:'text', required:true },
	{ key:'bride_name', label:'Êñ∞Â©¶Êßò„ÅÆ„ÅäÂêçÂâçÔºà‰æãÔºö‰ΩêË≥Ä Ëä±Â≠êÔºâ', type:'text', required:true },
	{ key:'phone', label:'ÈõªË©±Áï™Âè∑Ôºà„Éè„Ç§„Éï„É≥ÂèØÔºâ', type:'tel', required:true },
	{ key:'email', label:'„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ', type:'email', required:true },
	{ key:'address', label:'„Åî‰ΩèÊâÄÔºàÂ∏ÇÂå∫Áî∫Êùë‰ª•ÈôçÔºâ', type:'text', required:true },
	{ key:'has_kids', label:'„ÅäÂ≠êÊßò„ÅØ„ÅÑ„Çâ„Å£„Åó„ÇÉ„ÅÑ„Åæ„Åô„ÅãÔºü', type:'singleChoice', options:['„ÅÇ„Çä','„Å™„Åó'] },
	{ key:'visit_1st', label:'Êù•È§®Â∏åÊúõÊó•ÔºàÁ¨¨1Â∏åÊúõÔºâ„Çí„Ç´„É¨„É≥„ÉÄ„Éº„Åã„ÇâÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', type:'date', required:true },
	{ key:'visit_2nd', label:'Êù•È§®Â∏åÊúõÊó•ÔºàÁ¨¨2Â∏åÊúõÔºâ„Çí„Ç´„É¨„É≥„ÉÄ„Éº„Åã„ÇâÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', type:'date', required:true }
  ];

  // ===== ÂèÇÁÖßÔºàÂÖ®ÈÉ®„Éç„Éº„É†„Çπ„Éö„Éº„ÇπIDÔºâ =====
  const launcher=document.getElementById('ihgcb-launcher');
  const box=document.getElementById('ihgcb-box');
  const chat=document.getElementById('ihgcb-chat');
  const input=document.getElementById('ihgcb-input');
  const send=document.getElementById('ihgcb-send');
  const closeBtn=document.getElementById('ihgcb-close');
  const loading=document.getElementById('ihgcb-loading');

  const state={step:0,answers:{},started:false,confirming:false};
  const todayISO=()=>new Date().toISOString().slice(0,10);
  function bubble(txt,who='ihgcb-sys'){const d=document.createElement('div');d.className=who;d.textContent=txt;chat.appendChild(d);chat.scrollTop=chat.scrollHeight}

  // ===== UI: ÈÅ∏ÊäûËÇ¢ =====
  function renderChoices(q){
	const wrap=document.createElement('div');wrap.className='ihgcb-sys ihgcb-choices';wrap.dataset.step=state.step;
	if(q.type==='singleChoice'){
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent=opt;b.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(opt);});wrap.appendChild(b)});
	}else{ // multi
	  const selected=new Set();
	  q.options.forEach(opt=>{const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent=opt;b.addEventListener('click',()=>{b.classList.toggle('selected');b.classList.contains('selected')?selected.add(opt):selected.delete(opt);updateConfirm();});wrap.appendChild(b)});
	  const ok=document.createElement('button');ok.type='button';ok.className='ihgcb-pill ihgcb-confirm';ok.textContent='ÈÅ∏Êäû„ÇíÁ¢∫ÂÆö';
	  function updateConfirm(){const n=selected.size;if(n>0){ok.classList.add('active');ok.textContent=`ÈÅ∏Êäû„ÇíÁ¢∫ÂÆöÔºà${n}Ôºâ`;}else{ok.classList.remove('active');ok.textContent='ÈÅ∏Êäû„ÇíÁ¢∫ÂÆö';}}
	  ok.addEventListener('click',()=>{disableChoices(wrap);handleAnswer(Array.from(selected));});
	  wrap.appendChild(ok);
	}
	chat.appendChild(wrap);chat.scrollTop=chat.scrollHeight;
  }
  function disableChoices(wrap){wrap.querySelectorAll('button').forEach(b=>b.classList.add('disabled'));}

  // ===== ÈÄ≤Ë°å =====
  function ask(){
	if(state.step>=FLOW.length){return confirmBeforeSend();}
	const q=FLOW[state.step];
	bubble(`Q${state.step+1}Ôºö${q.label}`);

	if(q.type==='singleChoice'||q.type==='multiChoice'){
	  renderChoices(q);
	  send.disabled=true; // Êú™ÈÅ∏Êäû„ÅßÈÄ≤„Åæ„Å™„ÅÑ
	  input.type='text'; input.value='';
	}else{
	  send.disabled=false;
	  if(q.type==='date'){input.type='date';input.min=todayISO();input.value=todayISO();}
	  else if(q.type==='email'){input.type='email';input.value='';}
	  else if(q.type==='tel'){input.type='tel';input.value='';}
	  else{input.type='text';input.value='';}
	  input.focus();
	}
  }

  function handleAnswer(val){
	const q=FLOW[state.step];
	if(val===undefined && (q.type==='singleChoice'||q.type==='multiChoice')){ bubble('ÈÅ∏ÊäûËÇ¢„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ'); return; }
	const raw=(val!==undefined)?val:(input.value||'').trim();
	if(q.required){ if(Array.isArray(raw)?raw.length===0:!raw){ bubble('ÂøÖÈ†àÂÖ•Âäõ„Åß„Åô'); return; } }
	bubble(Array.isArray(raw)?raw.join('„ÄÅ'):raw,'ihgcb-user');
	state.answers[q.key]=raw; state.step++;
	loading.classList.add('active');
	setTimeout(()=>{ loading.classList.remove('active'); ask(); },500);
  }

  function confirmBeforeSend(){
	if(state.confirming) return; state.confirming=true;
	bubble('„Åì„ÅÆÂÜÖÂÆπ„ÅßÈÄÅ‰ø°„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü');
	const wrap=document.createElement('div');wrap.className='ihgcb-sys ihgcb-choices';
	const b=document.createElement('button');b.type='button';b.className='ihgcb-pill';b.textContent='„ÅØ„ÅÑ';
	b.addEventListener('click',()=>{disableChoices(wrap); finish();});
	wrap.appendChild(b); chat.appendChild(wrap); chat.scrollTop=chat.scrollHeight;
  }

  function finish(){
	loading.classList.add('active');
	setTimeout(()=>{
	  loading.classList.remove('active');
	  bubble('„Åì„ÅÆÂÜÖÂÆπ„ÅßÈÄÅ‰ø°„Åó„Åæ„Åô');
	  setTimeout(()=>{
		try{
		  // „Çµ„É≥„Éâ„Éú„ÉÉ„ÇØ„Çπ„Åß„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„Åå„Éñ„É≠„ÉÉ„ÇØ„Åï„Çå„Å¶„ÇÇËêΩ„Å®„Åï„Å™„ÅÑ
		  if(typeof location !== 'undefined' && typeof location.assign === 'function'){
			window.location.assign(THANKS_URL);
		  }else{
			throw new Error('navigation not allowed');
		  }
		}catch(err){
		  // ‰ª£Êõø: „ÉÅ„É£„ÉÉ„ÉàÂÜÖ„Å´„É™„É≥„ÇØ„ÇíË°®Á§∫
		  const msg=document.createElement('div');
		  msg.className='ihgcb-sys';
		  const a=document.createElement('a');
		  a.href=THANKS_URL; a.textContent='‚Üí „Çµ„É≥„ÇØ„Çπ„Éö„Éº„Ç∏„Å∏ÁßªÂãï'; a.target='_blank'; a.rel='noopener noreferrer';
		  msg.appendChild(a);
		  chat.appendChild(msg); chat.scrollTop=chat.scrollHeight;
		}
	  },900);
	},800);
  }

  // ===== ÈñãÈñâÔºàÂÖ¨Èñã & „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂ§öÊï∞Ôºâ =====
  let toggleBusy=false;
  function openBox(){ box.classList.add('open'); launcher.setAttribute('aria-expanded','true'); box.setAttribute('aria-hidden','false'); if(!state.started){ state.started=true; bubble('„ÅîÁõ∏Ë´á„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ„ÅÑ„Åè„Å§„Åã„ÅÆË≥™Âïè„Å´„ÅäÁ≠î„Åà„Åè„Å†„Åï„ÅÑ„ÄÇ'); ask(); } }
  function closeBox(){ box.classList.remove('open'); launcher.setAttribute('aria-expanded','false'); box.setAttribute('aria-hidden','true'); }
  function toggle(){ try{ if(toggleBusy) return; toggleBusy=true; setTimeout(()=>toggleBusy=false,200); box.classList.contains('open')? closeBox(): openBox(); } catch(e){ try{ openBox(); }catch(_){} } }

  // Áõ¥Êé•„Éê„Ç§„É≥„Éâ
  launcher.onclick = toggle;
  closeBtn.onclick = closeBox;
  send.onclick = ()=>handleAnswer();
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeBox(); });

  // „Éâ„Ç≠„É•„É°„É≥„ÉàÂßîË≠≤
  document.addEventListener('click',function(e){ const t=e.target && (e.target.id==='ihgcb-launcher'? e.target : (e.target.closest && e.target.closest('#ihgcb-launcher'))); if(t){ toggle(); } },{passive:true});
  document.addEventListener('keydown',function(e){ if((e.key==='Enter'||e.key===' ') && document.activeElement && document.activeElement.id==='ihgcb-launcher'){ e.preventDefault(); toggle(); } });

  // „Ç∞„É≠„Éº„Éê„É´ÂÖ¨ÈñãÔºà„Ç§„É≥„É©„Ç§„É≥Ëµ∑ÂãïÁî®Ôºâ
  window.ihgcb_toggle = toggle;

  // „É©„É≥„ÉÅ„É£„ÉºDOM„ÅåÂ∑Æ„ÅóÊõø„Åà„Çâ„Çå„Å¶„ÇÇÂÜç„Éê„Ç§„É≥„Éâ
  if('MutationObserver' in window){
	new MutationObserver(()=>{ const ln=document.getElementById('ihgcb-launcher'); if(ln && !ln.onclick){ ln.onclick=toggle; } }).observe(document.body,{childList:true,subtree:true});
  }

  // ÂàùÊúü„ÅØÈñâ„Åò„Çã
  closeBox();

  // ===== Á∞°Êòì„Çª„É´„Éï„ÉÜ„Çπ„ÉàÔºà„Ç®„É©„ÉºÊó©ÊúüÊ§úÁü•Ôºâ =====
  (function selfTest(){
	try{
	  const must = [launcher, box, chat, input, send, closeBtn, loading];
	  if(must.some(n=>!n)) throw new Error('ÂøÖÈ†àDOM„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
	  if(typeof window.ihgcb_toggle !== 'function') throw new Error('toggleÊú™ÂÖ¨Èñã');
	  // THANKS_URL„ÅÆËß£Ê±∫„ÅåÁ©∫ÊñáÂ≠ó„Åß„Å™„ÅÑ„Åì„Å®
	  if(!THANKS_URL || typeof THANKS_URL!=='string') throw new Error('THANKS_URL„Åå‰∏çÊ≠£');
	  console.log('[ihgcb] self-test: OK', {THANKS_URL});
	}catch(err){
	  console.error('[ihgcb] self-test failed:', err);
	}
  })();

  // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº„ÇíÊè°„Çä„Å§„Å∂„Åï„Åö„É≠„Ç∞
  window.addEventListener('error', function(ev){
	try{ console.error('[ihgcb] window error:', ev.error || ev.message); }catch(_){}
  });
})();
</script>
</body>
</html>
